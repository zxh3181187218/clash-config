mixed-port: 10808
allow-lan: false
mode: rule
log-level: warning
external-controller: 127.0.0.1:9090
secret: ""

# ===== DNS 优化 =====
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "localhost.ptlogin2.qq.com"
  default-nameserver:
    - 223.5.5.5
    - 114.114.114.114
  nameserver:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
    - 1.1.1.1
    - 8.8.8.8
  fallback:
    - 223.5.5.5
    - 114.114.114.114
    - tls://dns.alidns.com:853
  nameserver-policy:
    "geosite:cn,private,apple-cn,government-cn":
      - 223.5.5.5
      - 114.114.114.114
    "domain:googleapis.cn,gstatic.com,google.cn":
      - 1.1.1.1
      - 8.8.8.8
    "geosite:geolocation-!cn":
      - https://dns.google/dns-query
      - https://cloudflare-dns.com/dns-query

# ===== 代理节点 =====
proxies:
  # === 成都节点 (国内优化) ===
  - name: "成都节点"
    type: vmess
    server: 47.108.130.60
    port: 51691
    uuid: 51329a89-76f0-42e2-f7d9-d660147e4b15
    alterId: 0
    cipher: auto
    udp: true
    network: ws
    tls: false
    skip-cert-verify: true
    ws-opts:
      path: /
      headers:
        Host: pull.free.video.10010.com

  # === 美国节点 (Reality 推荐配置) ===
  - name: "美国节点"
    type: vless
    server: ipv6.zxh425.dpdns.org
    port: 443
    uuid: 3a7d914d-86d9-4cec-8e65-b08f5c0b98ab
    flow: xtls-rprx-vision
    network: tcp
    tls: true
    skip-cert-verify: false
    udp: true
    client-fingerprint: chrome
    reality-opts:
      public-key: "IXNtZnkoBPz2Yz-o1Jia8gQLeCj4mh-cszPFQys_OH4"
      short-id: "7d1cbe5789dfd04b"
      spider-x: ""

  # === Hysteria2 备用节点（推荐）===
  - name: "HY2备用"
    type: hysteria2
    server: ipv6.zxh425.dpdns.org
    port: 443
    password: "3n5T8b9NhTZe5cm2NW"
    sni: "ipv6.zxh425.dpdns.org"
    skip-cert-verify: false
    alpn:
      - h3
    obfs:
      type: salamander
      salamander-password: "96Jj12oLbwuEQOrZ39"
    up: "50 Mbps"
    down: "200 Mbps"
    fast-open: true

# ===== 代理组 =====
proxy-groups:
  - name: "国内分流"
    type: select
    proxies:
      - "成都节点"
    interface-name: "WLAN|Ethernet"  # 可选：绑定网卡

  - name: "国外分流"
    type: url-test
    proxies:
      - "美国节点"
      - "HY2备用"
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50
    lazy: true

  - name: "总代理"
    type: select
    proxies:
      - "国外分流"
      - "国内分流"
      - DIRECT
    use:
      - ""

  - name: "最终兜底"
    type: select
    proxies:
      - DIRECT
      - "国外分流"

# ===== 规则集 =====
rules:
  # 国内强制走成都节点（优先级最高）
  - GEOSITE,cn,国内分流
  - GEOIP,CN,国内分流
  - GEOSITE,private,国内分流
  - GEOIP,PRIVATE,国内分流
  - GEOIP,LAN,国内分流

  # 国外强制走美国节点或HY2
  - GEOSITE,geolocation-!cn,国外分流
  - GEOIP,!CN,国外分流

  # 特殊域名处理（国内节点）
  - DOMAIN-SUFFIX,googleapis.cn,国内分流
  - DOMAIN-SUFFIX,gstatic.com,国内分流

  # 防止泄漏
  - DST-PORT,853,DIRECT
  - DST-PORT,53,DIRECT

  # 兜底走国外
  - MATCH,国外分流