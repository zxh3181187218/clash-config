# Clash Meta 配置文
# 包含智能分流和 DNS 防泄露

# 混合端口,用于 HTTP 和 SOCKS5 代理
mixed-port: 7890

# 允许局域网连接
allow-lan: true

# 绑定地址
bind-address: '*'

# 运行模式: rule(规则模式)
mode: rule

# 日志级别
log-level: info

# 外部控制端口
external-controller: '127.0.0.1:9090'

# DNS 配置 - 防止 DNS 泄露
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  # 使用 fake-ip 模式,防止 DNS 泄露
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.localdomain'
    - '*.example'
    - '*.invalid'
    - '*.localhost'
    - '*.test'
    - '*.local'
    - 'localhost.ptlogin2.qq.com'
    - '+.srv.nintendo.net'
    - '+.stun.playstation.net'
    - '+.msftconnecttest.com'
    - '+.msftncsi.com'
    - '+.xboxlive.com'
    - 'msftconnecttest.com'
    - 'xbox.*.microsoft.com'
    - '*.battlenet.com.cn'
    - '*.battlenet.com'
    - '*.blzstatic.cn'
    - '*.battle.net'
  
  # 默认 DNS 服务器 - 用于解析 DoH 域名
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 114.114.114.114
  
  # 主 DNS 服务器 - 国内域名
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  
  # 备用 DNS - 国外域名通过代理查询
  fallback:
    - 8.8.8.8
    - 1.1.1.1
    - https://1.1.1.1/dns-query
    - https://dns.google/dns-query
  
  # fallback 策略
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.twitter.com'

# 代理节点配置
proxies:
  # 美国 Hysteria2 节点
  - name: "美国-Hysteria2"
    type: hysteria2
    server: ipv6.zxh425.dpdns.org
    port: 443
    password: 3n5T8b9NhTZe5cm2NW
    obfs: salamander
    obfs-password: 96Jj12oLbwuEQOrZ39
    sni: ipv6.zxh425.dpdns.org
    skip-cert-verify: false

  # 成都 VMess 节点
  - name: "成都-VMess"
    type: vmess
    server: 47.108.130.60
    port: 51691
    uuid: 5132a989-76f0-42e2-f7d9-d660147e4b15
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: /
      headers:
        Host: pull.free.video.10010.com
    tls: false

  # 美国 VLESS 节点
  - name: "美国-VLESS"
    type: vless
    server: ipv6.zxh425.dpdns.org
    port: 443
    uuid: 3a7d914d-86d9-4cec-8e65-b08f5c0b98ab
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername: gateway.icloud.com
    reality-opts:
      public-key: IXNtZnkoBPz2Yz-o1Jia8gQLeCj4mh-cszPFQys_OH4
      short-id: f71dda44e6f4f3b7
    client-fingerprint: chrome

# 策略组配置
proxy-groups:
  # 主选择组
  - name: "PROXY"
    type: select
    proxies:
      - "美国节点"
      - "美国-Hysteria2"
      - "美国-VLESS"
      - DIRECT

  # 美国节点组
  - name: "美国节点"
    type: select
    proxies:
      - "美国-Hysteria2"
      - "美国-VLESS"

  # 国内流量组
  - name: "国内流量"
    type: select
    proxies:
      - "成都-VMess"
      - DIRECT

  # 国际流媒体
  - name: "国际流媒体"
    type: select
    proxies:
      - "美国节点"
      - "美国-Hysteria2"
      - "美国-VLESS"

  # 苹果服务
  - name: "Apple"
    type: select
    proxies:
      - DIRECT
      - "美国节点"
      - "国内流量"

  # 微软服务
  - name: "Microsoft"
    type: select
    proxies:
      - DIRECT
      - "美国节点"

  # 广告拦截
  - name: "AdBlock"
    type: select
    proxies:
      - REJECT
      - DIRECT

# 规则配置
rules:
  # 局域网地址
  - DOMAIN-SUFFIX,local,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT
  - IP-CIDR,224.0.0.0/4,DIRECT
  - IP-CIDR,fe80::/10,DIRECT

  # 广告拦截
  - DOMAIN-KEYWORD,adservice,AdBlock
  - DOMAIN-KEYWORD,analytics,AdBlock
  - DOMAIN-SUFFIX,doubleclick.net,AdBlock

  # 国际流媒体
  - DOMAIN-KEYWORD,youtube,国际流媒体
  - DOMAIN-KEYWORD,netflix,国际流媒体
  - DOMAIN-SUFFIX,netflix.com,国际流媒体
  - DOMAIN-SUFFIX,youtu.be,国际流媒体
  - DOMAIN-SUFFIX,googlevideo.com,国际流媒体
  - DOMAIN-SUFFIX,twitch.tv,国际流媒体
  - DOMAIN-SUFFIX,hulu.com,国际流媒体
  - DOMAIN-SUFFIX,disney.com,国际流媒体
  - DOMAIN-SUFFIX,disneyplus.com,国际流媒体

  # Apple 服务
  - DOMAIN-SUFFIX,apple.com,Apple
  - DOMAIN-SUFFIX,icloud.com,Apple
  - DOMAIN-SUFFIX,mzstatic.com,Apple
  - DOMAIN-SUFFIX,appstore.com,Apple

  # Microsoft 服务
  - DOMAIN-SUFFIX,microsoft.com,Microsoft
  - DOMAIN-SUFFIX,windows.com,Microsoft
  - DOMAIN-SUFFIX,office.com,Microsoft
  - DOMAIN-SUFFIX,live.com,Microsoft

  # 中国常用应用和网站
  - DOMAIN-SUFFIX,qq.com,国内流量
  - DOMAIN-SUFFIX,wechat.com,国内流量
  - DOMAIN-SUFFIX,weixin.qq.com,国内流量
  - DOMAIN-SUFFIX,taobao.com,国内流量
  - DOMAIN-SUFFIX,tmall.com,国内流量
  - DOMAIN-SUFFIX,jd.com,国内流量
  - DOMAIN-SUFFIX,alipay.com,国内流量
  - DOMAIN-SUFFIX,baidu.com,国内流量
  - DOMAIN-SUFFIX,bilibili.com,国内流量
  - DOMAIN-SUFFIX,163.com,国内流量
  - DOMAIN-SUFFIX,sina.com.cn,国内流量
  - DOMAIN-SUFFIX,sohu.com,国内流量
  - DOMAIN-SUFFIX,douyin.com,国内流量
  - DOMAIN-SUFFIX,toutiao.com,国内流量
  - DOMAIN-SUFFIX,zhihu.com,国内流量
  - DOMAIN-SUFFIX,weibo.com,国内流量
  - DOMAIN-SUFFIX,youku.com,国内流量
  - DOMAIN-SUFFIX,iqiyi.com,国内流量
  - DOMAIN-SUFFIX,tencent.com,国内流量
  - DOMAIN-SUFFIX,163.com,国内流量

  # 中国银行和政府网站
  - DOMAIN-SUFFIX,gov.cn,国内流量
  - DOMAIN-SUFFIX,edu.cn,国内流量
  - DOMAIN-SUFFIX,12306.cn,国内流量

  # GeoIP 规则 - 中国 IP 走国内流量
  - GEOIP,CN,国内流量

  # 其他所有流量走代理
  - MATCH,PROXY