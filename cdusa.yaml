# Clash Meta 配置文件
# 端口配置
port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: false
bind-address: '*'
mode: rule
log-level: info
ipv6: true
external-controller: 127.0.0.1:9090

# DNS 配置 - 防止 DNS 泄露
dns:
  enable: true
  ipv6: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  fallback:
    - https://1.1.1.1/dns-query
    - https://dns.google/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4

# 代理节点配置
proxies:
  # Hysteria2 节点 - 美国
  - name: "美国-HY2"
    type: hysteria2
    server: ipv6.zxh425.dpdns.org
    port: 443
    password: 3n5T8b9NhTZe5cm2NW
    obfs: salamander
    obfs-password: 96Jj12oLbwuEQOrZ39
    sni: ipv6.zxh425.dpdns.org
    skip-cert-verify: false

  # VMess 节点 - 成都
  - name: "成都-VMess"
    type: vmess
    server: 47.108.130.60
    port: 51691
    uuid: 51329a89-76f0-42e2-f7d9-d660147e4b15
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: /
      headers:
        Host: pull.free.video.10010.com

  # VLESS 节点 - 美国
  - name: "美国-VLESS"
    type: vless
    server: ipv6.zxh425.dpdns.org
    port: 443
    uuid: 3a7d914d-86d9-4cec-8e65-b08f5c0b98ab
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername: gateway.icloud.com
    reality-opts:
      public-key: IXNtZnkoBPz2Yz-o1Jia8gQLeCj4mh-cszPFQys_OH4
      short-id: f71dda44e6f4f3b7
    client-fingerprint: chrome

# 策略组配置
proxy-groups:
  # 主选择组
  - name: "PROXY"
    type: select
    proxies:
      - "自动选择"
      - "美国节点"
      - "成都节点"
      - "美国-HY2"
      - "美国-VLESS"
      - "成都-VMess"

  # 美国节点组
  - name: "美国节点"
    type: select
    proxies:
      - "美国-HY2"
      - "美国-VLESS"

  # 成都节点组
  - name: "成都节点"
    type: select
    proxies:
      - "成都-VMess"

  # 自动选择（延迟最低）
  - name: "自动选择"
    type: url-test
    proxies:
      - "美国-HY2"
      - "美国-VLESS"
    url: 'http://www.gstatic.com/generate_204'
    interval: 300

  # 国内流量
  - name: "国内流量"
    type: select
    proxies:
      - "成都节点"
      - "成都-VMess"

  # 国外流量
  - name: "国外流量"
    type: select
    proxies:
      - "美国节点"
      - "美国-HY2"
      - "美国-VLESS"

# 规则配置
rules:
  # 防止 DNS 泄露
  - DOMAIN-SUFFIX,dns.google,国外流量
  - DOMAIN-SUFFIX,cloudflare-dns.com,国外流量
  - DOMAIN-SUFFIX,1dot1dot1dot1.cloudflare-dns.com,国外流量

  # 国内域名直连（使用成都节点）
  - DOMAIN-SUFFIX,cn,国内流量
  - DOMAIN-KEYWORD,baidu,国内流量
  - DOMAIN-KEYWORD,taobao,国内流量
  - DOMAIN-KEYWORD,alipay,国内流量
  - DOMAIN-KEYWORD,qq,国内流量
  - DOMAIN-KEYWORD,weixin,国内流量
  - DOMAIN-KEYWORD,wechat,国内流量
  - DOMAIN-SUFFIX,aliyun.com,国内流量
  - DOMAIN-SUFFIX,tmall.com,国内流量
  - DOMAIN-SUFFIX,jd.com,国内流量
  - DOMAIN-SUFFIX,bilibili.com,国内流量
  - DOMAIN-SUFFIX,douyin.com,国内流量
  - DOMAIN-SUFFIX,toutiao.com,国内流量
  - DOMAIN-SUFFIX,163.com,国内流量
  - DOMAIN-SUFFIX,sina.com.cn,国内流量
  - DOMAIN-SUFFIX,sohu.com,国内流量
  - DOMAIN-SUFFIX,youku.com,国内流量
  - DOMAIN-SUFFIX,iqiyi.com,国内流量
  - DOMAIN-SUFFIX,zhihu.com,国内流量
  - DOMAIN-SUFFIX,csdn.net,国内流量
  - DOMAIN-SUFFIX,jianshu.com,国内流量

  # 中国 IP 段（使用成都节点）
  - GEOIP,CN,国内流量

  # 局域网地址（使用成都节点）
  - IP-CIDR,192.168.0.0/16,国内流量,no-resolve
  - IP-CIDR,10.0.0.0/8,国内流量,no-resolve
  - IP-CIDR,172.16.0.0/12,国内流量,no-resolve
  - IP-CIDR,127.0.0.0/8,国内流量,no-resolve

  # 国外流量（使用美国节点）
  - DOMAIN-SUFFIX,google.com,国外流量
  - DOMAIN-SUFFIX,youtube.com,国外流量
  - DOMAIN-SUFFIX,facebook.com,国外流量
  - DOMAIN-SUFFIX,twitter.com,国外流量
  - DOMAIN-SUFFIX,instagram.com,国外流量
  - DOMAIN-SUFFIX,telegram.org,国外流量
  - DOMAIN-SUFFIX,whatsapp.com,国外流量
  - DOMAIN-SUFFIX,netflix.com,国外流量
  - DOMAIN-SUFFIX,openai.com,国外流量
  - DOMAIN-SUFFIX,github.com,国外流量
  - DOMAIN-KEYWORD,google,国外流量
  - DOMAIN-KEYWORD,youtube,国外流量
  - DOMAIN-KEYWORD,facebook,国外流量
  - DOMAIN-KEYWORD,twitter,国外流量
  - DOMAIN-KEYWORD,telegram,国外流量

  # 默认规则：所有其他流量走国外节点
  - MATCH,国外流量