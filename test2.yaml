# Clash Meta Config - Transit & Direct Topology
# 架构：成都中转德国 (国外) + 成都本地直连 (国内)

port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: true
mode: rule
log-level: info
ipv6: false
external-controller: 127.0.0.1:9090

# --- 必须开启 TUN 模式 ---
# 配合你的安卓手机，确保所有 App 流量都乖乖听话
tun:
  enable: true
  stack: system
  auto-route: true
  auto-detect-interface: true
  dns-hijack:
    - any:53

# --- DNS 配置 (精准匹配你的服务器路由) ---
dns:
  enable: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  respect-rules: true 

  # 1. 国外 DNS (Google) -> 走 15821 端口 (德国出口)
  # 这样你的 DNS 请求会从德国发出，绝对安全，无污染
  nameserver:
    - https://8.8.8.8/dns-query
    - https://1.1.1.1/dns-query

  # 2. 国内 DNS (阿里/腾讯) -> 走 49084 端口 (成都出口)
  # 这样你能获得最快的国内 CDN 解析，且没有泄漏风险
  nameserver-policy:
    "geosite:cn,private":
      - https://223.5.5.5/dns-query
      - https://119.29.29.29/dns-query

# --- 节点定义 ---
proxies:
  # 节点1：国外流量专用 (流量去德国)
  - name: "✈️ 德国 (成都中转)"
    type: vmess
    server: 47.108.130.60    # 入口IP：成都
    port: 15821              # 入口端口：15821 -> 转发到德国
    uuid: 4b64ce4d-72d5-463b-acba-90773c064ab8
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: pull.free.video.10010.com

  # 节点2：国内流量专用 (流量在成都直接出)
  - name: "🏠 成都 (本地直连)"
    type: vmess
    server: 47.108.130.60    # 入口IP：成都
    port: 49084              # 入口端口：49084 -> 本地直连
    uuid: 4b64ce4d-72d5-463b-acba-90773c064ab8
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: pull.free.video.10010.com

# --- 策略组 (逻辑绑定) ---
proxy-groups:
  # 1. 国外组 -> 强制绑定 15821 端口
  - name: "🌍 国外流量"
    type: select
    proxies:
      - "✈️ 德国 (成都中转)"

  # 2. 国内组 -> 强制绑定 49084 端口
  # 这样访问国内网站时，流量直接从成都服务器出去，速度起飞
  - name: "🇨🇳 国内流量"
    type: select
    proxies:
      - "🏠 成都 (本地直连)"
      - DIRECT  # 备用：如果不免流，也可切回手机直连

  # 3. 兜底
  - name: "🐟 漏网之鱼"
    type: select
    proxies:
      - "🌍 国外流量"
      - "🇨🇳 国内流量"

# --- 规则 ---
rules:
  # [DNS 分流核心]
  # 访问 Google DNS 的流量 -> 走“德国中转”
  - IP-CIDR,8.8.8.8/32,🌍 国外流量
  - IP-CIDR,1.1.1.1/32,🌍 国外流量
  
  # 访问 阿里 DNS 的流量 -> 走“成都直连”
  - IP-CIDR,223.5.5.5/32,🇨🇳 国内流量
  - IP-CIDR,119.29.29.29/32,🇨🇳 国内流量

  # [地区分流]
  - GEOSITE,cn,🇨🇳 国内流量
  - GEOSITE,private,🇨🇳 国内流量
  - GEOIP,cn,🇨🇳 国内流量
  
  # [默认]
  - MATCH,🌍 国外流量
  
