port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info
external-controller: :9090

# DNS 配置：使用 Fake-IP 模式，防止本地 DNS 泄露
# 因为全走代理，本地不需要解析真实 IP，全交给远端解析
dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - 223.5.5.5
    - 119.29.29.29

proxies:
  # --- 节点 1: 成都入口 ---
  - name: "1_成都中转"
    type: vmess
    server: 47.108.130.60
    port: 25477
    uuid: 8f800fe3-5af8-4021-cc74-fc159ca640a9
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: pull.free.video.10010.com

  # --- 节点 2: 美国出口 ---
  - name: "2_美国落地"
    type: vless
    server: hy2.zxh425.dpdns.org
    port: 443
    uuid: 3a7d914d-86d9-4cec-8e65-b08f5c0b98ab
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername: gateway.icloud.com
    client-fingerprint: chrome
    reality-opts:
      public-key: IXNtZnkoBPz2Yz-o1Jia8gQLeCj4mh-cszPFQys_OH4
      short-id: f71dda44e6f4f3b7

proxy-groups:
  # --- 策略组 1: 国外流量 (强制链式) ---
  # 路径: 本地 -> 成都 -> 美国
  - name: "✈️ 国外流量"
    type: relay
    proxies:
      - "1_成都中转"
      - "2_美国落地"

  # --- 策略组 2: 国内流量 (强制中转) ---
  # 路径: 本地 -> 成都
  # 这里虽然叫 select，但只放了一个节点，所以是强制的
  - name: "🏠 国内流量"
    type: select
    proxies:
      - "1_成都中转"

rules:
  # 1. 拦截国内域名 -> 强制走成都节点
  - GEOSITE,CN,🏠 国内流量
  
  # 2. 拦截国内 IP -> 强制走成都节点
  - GEOIP,CN,🏠 国内流量
  
  # 3. 剩余所有流量 (即国外) -> 强制走链式 (成都->美国)
  - MATCH,✈️ 国外流量
