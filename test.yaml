port: 7890
socks-port: 7891
allow-lan: true
mode: rule
log-level: info
external-controller: :9090

# --- DNS è®¾ç½® (ä¸¥æ ¼é”å®š CF/Google) ---
dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  
  # ã€å…³é”®ä¿®å¤ã€‘ä»£ç†æœåŠ¡å™¨ä¸“ç”¨ DNS
  # å¿…é¡»é…ç½®æ­¤é¡¹æ‰èƒ½å¼€å¯ respect-rulesã€‚
  # ä½ çš„å…¥å£èŠ‚ç‚¹æ˜¯ IPï¼Œè¿™å®é™…ä¸Šä¸ä¼šè¢«ç”¨åˆ°ï¼Œä½†å¿…é¡»å¡«ä»¥é€šè¿‡æ£€æŸ¥ã€‚
  proxy-server-nameserver:
    - 1.1.1.1
    - 8.8.8.8

  # å¸¸è§„ DNS (Fake-IP æ¨¡å¼ä¸‹ï¼Œè¿™äº›è¯·æ±‚ä¼šæ ¹æ® rules èµ°ä»£ç†)
  nameserver:
    - 1.1.1.1
    - 1.0.0.1
    - 8.8.8.8
    - 8.8.4.4
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
  
  # ç¦ç”¨ fallback
  fallback: []
  
  # å¼€å¯åï¼ŒDNS è¯·æ±‚ä¹Ÿä¼šå»åŒ¹é…ä¸‹é¢çš„ rules
  respect-rules: true

proxies:
  # --- èŠ‚ç‚¹ 1: æˆéƒ½å…¥å£ ---
  - name: "1_æˆéƒ½ä¸­è½¬"
    type: vmess
    server: 127.0.0.1
    port: 25477
    uuid: 8f800fe3-5af8-4021-cc74-fc159ca640a9
    alterId: 0
    cipher: auto
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: pull.free.video.10010.com

  # --- èŠ‚ç‚¹ 2: ç¾å›½å‡ºå£ ---
  - name: "2_ç¾å›½è½åœ°"
    type: vless
    server: xjp.abc.dpdns.org
    port: 443
    uuid: 3a7d914d-86d9-4cec-8e65-b08f5c0b98ab
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername: gateway.icloud.com
    client-fingerprint: chrome
    reality-opts:
      public-key: IXNtZnkoBPz2Yz-o1Jia8gQLeCj4mh-cszPFQys_OH4
      short-id: f71dda44e6f4f3b7

proxy-groups:
  # --- ç­–ç•¥ç»„ 1: å›½å¤–æµé‡ (é“¾å¼) ---
  - name: "âœˆï¸ å›½å¤–æµé‡"
    type: relay
    proxies:
      - "1_æˆéƒ½ä¸­è½¬"
      - "2_ç¾å›½è½åœ°"

  # --- ç­–ç•¥ç»„ 2: å›½å†…æµé‡ (ä¸­è½¬) ---
  - name: "ğŸ  å›½å†…æµé‡"
    type: select
    proxies:
      - "1_æˆéƒ½ä¸­è½¬"

rules:
  # 1. é˜»æ–­ WebRTC (UDP/TCP 3478)
  - DST-PORT,3478,REJECT
  
  # 2. DNS å¼•å¯¼è§„åˆ™ (å¼ºåˆ¶ DNS æŸ¥è¯¢èµ°æˆéƒ½èŠ‚ç‚¹)
  # è¿™æ ·ä½ çš„è®¾å¤‡è¯·æ±‚ 1.1.1.1 æ—¶ï¼Œæµé‡ä¼šç©¿è¿‡æˆéƒ½èŠ‚ç‚¹ï¼Œä»è€Œé¿å¼€æœ¬åœ°å¹²æ‰°
  - IP-CIDR,1.1.1.1/32,ğŸ  å›½å†…æµé‡
  - IP-CIDR,1.0.0.1/32,ğŸ  å›½å†…æµé‡
  - IP-CIDR,8.8.8.8/32,ğŸ  å›½å†…æµé‡
  - IP-CIDR,8.8.4.4/32,ğŸ  å›½å†…æµé‡

  # 3. åˆ†æµé€»è¾‘
  - GEOSITE,CN,ğŸ  å›½å†…æµé‡
  - GEOIP,CN,ğŸ  å›½å†…æµé‡
  
  # 4. å‰©ä½™å…¨èµ°é“¾å¼
  - MATCH,âœˆï¸ å›½å¤–æµé‡
  
